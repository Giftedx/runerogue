<!-- Generated by SpecStory -->

# /fix  (2025-06-19 04:43:41)

_**User**_

/fix 

---

_**Assistant**_

I'll help you fix the ESLint errors and warnings in the game-server package. Here's my solution:

## Step-by-Step Solution

1. Fix type imports to use `import type` for type-only imports
2. Replace deprecated `substr` with `substring`
3. Fix type annotations and remove unnecessary ones
4. Replace console.log with proper logging
5. Fix unsafe any types
6. Fix other ESLint violations

## File Changes

### [DeathSystem.test.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/ecs/systems/DeathSystem.test.ts)

Fix type imports:

````typescript
// ...existing code...
import type { GameState } from '../../schemas/GameState';
// ...existing code...

    const mockGameState = {
      players: new Map(),
      enemies: new Map(),
      items: new Map(),
    } as unknown as GameState;

    const result = deathSystem.execute(mockWorld, mockGameState, 16);
// ...existing code...
````

### [DeathSystem.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/ecs/systems/DeathSystem.ts)

Fix type imports and console statements:

````typescript
// ...existing code...
import { defineQuery, defineSystem, removeEntity, hasComponent, type World } from 'bitecs';
import type { Enemy, Player } from '../../schemas/GameState';
import type { GameWorld } from '../GameWorld';
// ...existing code...

      // Player died
      console.warn(`Player ${playerId} died`);
// ...existing code...
        console.error(`Player ${playerId} not found in world.entityToPlayer`);
// ...existing code...
      // Enemy died
      console.info(`Enemy ${enemyId} died`);
// ...existing code...
        console.error(`Enemy ${enemyId} not found in state.enemies`);
// ...existing code...
````

### [EnemyAISystem.test.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/ecs/systems/EnemyAISystem.test.ts)

Fix unused variable and type issues:

````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
// ...existing code...
import {
  OSRS_TICK_MS,
  // WEAPON_SPEEDS is removed as it's unused
} from '@runerogue/osrs-data';
// ...existing code...

      const mockGameState = {
        players: new Map(),
        enemies: new Map(),
        items: new Map(),
      } as unknown as GameState;

      const result = system.execute(mockWorld, mockGameState, 16);
// ...existing code...

      // Attack the player (number type is correct here)
      Combat.lastAttackTime[enemyId] = Date.now() - 2000;
// ...existing code...
````

### [EnemyAISystem.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/ecs/systems/EnemyAISystem.ts)

Fix type imports, unused parameter, and unnecessary conditional:

````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
// ...existing code...
import { defineQuery, defineSystem, hasComponent, type World } from 'bitecs';
import type { GameState } from '../../schemas/GameState';
// ...existing code...

  execute(world: World, state: GameState, _delta: number): World {
// ...existing code...

      // Remove the unnecessary conditional
      const distance = Math.sqrt(dx * dx + dy * dy);
// ...existing code...

        console.warn(`Enemy ${eid} has no valid target`);
// ...existing code...
````

### [index.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/index.ts)

Fix import types, unsafe any usage, and string concatenation:

````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
````typescript
// ...existing code...
const RuneRogueRoom = await import('./rooms/RuneRogueRoom').then(m => m.RuneRogueRoom);
// ...existing code...

  app.post('/room/create', express.json(), async (req: express.Request, res: express.Response) => {
    const options = req.body as Record<string, unknown>;
// ...existing code...
    return res.status(400).json({ error: 'Failed to create room' });
// ...existing code...
      return res.json({ roomId, error: e instanceof Error ? e.message : String(e) });
// ...existing code...
    return res.status(400).json({ error: 'Invalid room ID' });
// ...existing code...
    const roomData = req.body as Record<string, unknown>;
// ...existing code...
      const updatedRoom = await matchMaker.remoteRoomCall(
// ...existing code...
      return res.status(404).json({ 
        error: 'Room not found or update failed' 
      });
// ...existing code...
        error: e instanceof Error ? e.message : String(e)
// ...existing code...
      const rooms = await matchMaker.query(criteria as Partial<RoomListingData>);
      return res.json(rooms);
// ...existing code...
    res.status(500).json({ 
      error: e instanceof Error ? e.message : String(e) 
    });
// ...existing code...

  const serverPromise = server.listen(PORT, () => {
    console.info(`=== RuneRogue Game Server ===`);
    console.info(`Server running on port ${PORT}`);
    console.info(`Environment: ${process.env.NODE_ENV ?? 'development'}`);
// ...existing code...
  serverPromise.catch((error: unknown) => {
    console.error('Failed to start server:', error);
    process.exit(1);
  });
// ...existing code...
````

### [RuneRogueRoom.ts](file:///c%3A/Users/aggis/GitHub/runerogue/packages/game-server/src/rooms/RuneRogueRoom.ts)

Fix type imports, remove trivial type annotations, and replace deprecated substr:

````typescript
// ...existing code...
import { Room, type Client } from 'colyseus';
// ...existing code...

export class RuneRogueRoom extends Room<GameState> {
  private static readonly FRAME_RATE = 60;
  private static readonly UPDATE_RATE = 20;
  private static readonly TICK_RATE = 10;
// ...existing code...
  
  private gameLoop?: NodeJS.Timeout;
  private lastTickTime = Date.now();
  private accumulator = 0;
// ...existing code...

  onCreate(options: Record<string, unknown>) {
    console.info('Creating RuneRogue room with options:', options);
// ...existing code...
      console.error('Failed to set metadata:', error);
// ...existing code...
    console.info(`Player ${sessionId} joined`);
// ...existing code...
      console.warn(`Player ${sessionId} not found on disconnect`);
// ...existing code...
        console.warn(`Failed to handle player disconnect: ${error}`);
// ...existing code...
    console.info(`Player ${sessionId} left`);
// ...existing code...
    if (player?.sessionId && player.sessionId === sessionId) {
// ...existing code...
    console.info('Room disposed');
// ...existing code...
      console.error('Room disposed with error:', error);
// ...existing code...
    console.info('Starting game loop');
// ...existing code...

  onMessage(client: Client, type: string, data: Record<string

---

