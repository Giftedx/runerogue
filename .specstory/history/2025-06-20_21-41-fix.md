<!-- Generated by SpecStory -->

# /fix  (2025-06-20 22:41:02)

_**User**_

/fix 

---

_**Assistant**_

I'll analyze the project overview and propose fixes for the identified problems.

## Solution Overview

The main issues identified are:
1. Discord Activity infrastructure not started
2. Client needs complete refactor from legacy code
3. No client-server connection implemented
4. Test coverage needs improvement

I'll provide a step-by-step solution to establish the Phase 1 foundation.

## File Changes

### packages/phaser-client/package.json

Create a proper package.json with all required dependencies for the Discord Activity client:

````json
{
  "name": "@runerogue/phaser-client",
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "type-check": "tsc --noEmit",
    "lint": "eslint src --ext ts,tsx",
    "test": "jest"
  },
  "dependencies": {
    "@discord/embedded-app-sdk": "^1.2.0",
    "@runerogue/shared": "workspace:*",
    "colyseus.js": "^0.15.0",
    "phaser": "^3.70.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.7"
  },
  "devDependencies": {
    "@types/jest": "^29.5.0",
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^8.0.0",
    "eslint-plugin-react": "^7.0.0",
    "eslint-plugin-react-hooks": "^4.0.0",
    "jest": "^29.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.0",
    "ts-jest": "^29.1.0",
    "typescript": "^5.0.0",
    "vite": "^5.0.0"
  }
}
````

### packages/phaser-client/tsconfig.json

Create TypeScript configuration for the client:

````json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "allowJs": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@runerogue/shared": ["../shared/src"]
    }
  },
  "include": ["src", "vite.config.ts"],
  "references": [{ "path": "../shared" }]
}
````

### packages/phaser-client/vite.config.ts

Enhanced Vite configuration with proper Discord Activity support:

````typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@runerogue/shared': path.resolve(__dirname, '../shared/src'),
    },
  },
  server: {
    port: 3000,
    https: {
      key: fs.readFileSync(path.resolve(__dirname, 'key.pem')),
      cert: fs.readFileSync(path.resolve(__dirname, 'cert.pem')),
    },
    headers: {
      'Content-Security-Policy': [
        "default-src 'self'",
        "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://discord.com https://*.discord.com",
        "style-src 'self' 'unsafe-inline'",
        "img-src 'self' data: https: blob:",
        "connect-src 'self' wss: https: https://discord.com https://*.discord.com",
        "frame-ancestors https://discord.com https://discordapp.com https://*.discord.com",
        "frame-src https://discord.com https://*.discord.com",
      ].join('; '),
    },
    proxy: {
      '/api': {
        target: 'https://localhost:2567',
        changeOrigin: true,
        secure: false,
      },
    },
  },
  build: {
    outDir: 'dist',
    sourcemap: true,
    rollupOptions: {
      output: {
        manualChunks: {
          phaser: ['phaser'],
          react: ['react', 'react-dom'],
          discord: ['@discord/embedded-app-sdk'],
          colyseus: ['colyseus.js'],
        },
      },
    },
  },
  define: {
    'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'development'),
  },
});
````

### packages/phaser-client/tailwind.config.js

Tailwind configuration with Discord-themed colors:

````javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      colors: {
        discord: {
          dark: '#202225',
          darker: '#2f3136',
          darkest: '#36393f',
          blurple: '#5865f2',
          'blurple-hover': '#4752c4',
          green: '#3ba55d',
          red: '#ed4245',
          yellow: '#faa81a',
        },
      },
      fontFamily: {
        discord: ['gg sans', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
      },
    },
  },
  plugins: [],
};
````

### packages/phaser-client/postcss.config.js

PostCSS configuration for Tailwind:

````javascript
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
````

### packages/phaser-client/index.html

HTML entry point for the Discord Activity:

````html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RuneRogue - Discord Activity</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
````

### packages/phaser-client/src/main.tsx

Main entry point with Discord SDK initialization:

````typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { App } from './App';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import './index.css';

/**
 * Initialize Discord SDK and render the app
 */
async function initializeApp() {
  try {
    // Initialize Discord SDK
    const discordSdk = new DiscordSDK(import.meta.env.VITE_DISCORD_CLIENT_ID);
    
    // Wait for Discord to be ready
    await discordSdk.ready();
    console.log('Discord SDK initialized');

    // Authenticate with Discord
    const { code } = await discordSdk.commands.authorize({
      client_id: import.meta.env.VITE_DISCORD_CLIENT_ID,
      response_type: 'code',
      state: '',
      prompt: 'none',
      scope: ['identify', 'guilds', 'rpc.voice.read'],
    });

    // Exchange code for access token via our backend
    const response = await fetch('/api/auth/discord/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ code }),
    });

    if (!response.ok) {
      throw new Error('Failed to authenticate with Discord');
    }

    const { access_token } = await response.json();

    // Authenticate SDK with access token
    const auth = await discordSdk.commands.authenticate({
      access_token,
    });

    if (!auth.user) {
      throw new Error('Failed to get Discord user');
    }

    console.log('Authenticated as:', auth.user.username);

    // Render the app with Discord context
    const root = ReactDOM.createRoot(
      document.getElementById('root') as HTMLElement
    );

    root.render(
      <React.StrictMode>
        <App discord={discordSdk} user={auth.user} />
      </React.StrictMode>
    );
  } catch (error) {
    console.error('Failed to initialize Discord Activity:', error);
    
    // Render error state
    const root = ReactDOM.createRoot(
      document.getElementById('root') as HTMLElement
    );
    
    root.render(
      <React.StrictMode>
        <div className="flex items-center justify-center min-h-screen bg-discord-darkest text-white">
          <div className="text-center">
            <h1 className="text-2xl font-bold mb-4">Failed to Initialize</h1>
            <p className="text-gray-400">Please ensure you're running this as a Discord Activity.</p>
            <p className="text-sm text-gray-500 mt-2">{String(error)}</p>
          </div>
        </div>
      </React.StrictMode>
    );
  }
}

// Initialize the app
initializeApp();
````

### packages/phaser-client/src/index.css

Base styles with Tailwind imports:

````css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply bg-discord-darkest text-white font-discord;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  #root {
    width: 100vw;
    height: 100vh;
  }
}

@layer components {
  .discord-button {
    @apply bg-discord-blurple hover:bg-discord-blurple-hover text-white font-medium py-2 px-4 rounded transition-colors;
  }

  .discord-panel {
    @apply bg-discord-dark rounded-lg p-4 shadow-lg;
  }

  .discord-input {
    @apply bg-discord-darker border border-gray-600 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-discord-blurple;
  }
}
````

### packages/phaser-client/src/App.tsx

Main App component with Phaser and React integration:

````typescript
import React, { useEffect, useRef, useState } from 'react';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { Game } from './game/Game';
import { NetworkManager } from './network/NetworkManager';
import { useGameStore } from './store/gameStore';
import { MainMenu } from './components/MainMenu';
import { GameUI } from './components/GameUI';
import { LoadingScreen } from './components/LoadingScreen';

interface AppProps {
  discord: DiscordSDK;
  user: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  };
}

/**
 * Main application component
 */
export const App: React.FC<AppProps> = ({ discord, user }) => {
  const gameRef = useRef<Game | null>(null);
  const networkRef = useRef<NetworkManager | null>(null);
  const [gameState, setGameState] = useState<'menu' | 'loading' | 'playing'>('menu');
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // Initialize game store with user data
    useGameStore.getState().setDiscordUser(user);
    useGameStore.getState().setDiscordSDK(discord);

    // Set up Discord activity
    discord.commands.setActivity({
      state: 'In Menu',
      details: 'RuneRogue',
    });

    return () => {
      // Cleanup on unmount
      if (gameRef.current) {
        gameRef.current.destroy();
      }
      if (networkRef.current) {
        networkRef.current.disconnect();
      }
    };
  }, [discord, user]);

  /**
   * Start the game
   */
  const handleStartGame = async () => {
    try {
      setGameState('loading');
      setError(null);

      // Create network manager
      networkRef.current = new NetworkManager(
        import.meta.env.VITE_GAME_SERVER_URL,
        user.id
      );

      // Connect to game server
      await networkRef.current.connect();

      // Join or create a room
      const room = await networkRef.current.joinRoom('game', {
        discordId: user.id,
        username: user.username,
      });

      // Create Phaser game
      gameRef.current = new Game(
        'game-container',
        networkRef.current,
        discord
      );

      // Wait for game to be ready
      await gameRef.current.ready();

      setGameState('playing');

      // Update Discord activity
      discord.commands.setActivity({
        state: 'Playing',
        details: 'RuneRogue',
        party: {
          id: room.id,
          size: [1, 4],
        },
      });
    } catch (err) {
      console.error('Failed to start game:', err);
      setError(err instanceof Error ? err.message : 'Failed to start game');
      setGameState('menu');
    }
  };

  /**
   * Return to main menu
   */
  const handleReturnToMenu = () => {
    if (gameRef.current) {
      gameRef.current.destroy();
      gameRef.current = null;
    }
    if (networkRef.current) {
      networkRef.current.disconnect();
      networkRef.current = null;
    }
    setGameState('menu');
    setError(null);

    // Update Discord activity
    discord.commands.setActivity({
      state: 'In Menu',
      details: 'RuneRogue',
    });
  };

  return (
    <div className="relative w-full h-full bg-discord-darkest">
      {gameState === 'menu' && (
        <MainMenu
          user={user}
          onStartGame={handleStartGame}
          error={error}
        />
      )}

      {gameState === 'loading' && <LoadingScreen />}

      {gameState === 'playing' && (
        <>
          <div id="game-container" className="absolute inset-0" />
          <GameUI onReturnToMenu={handleReturnToMenu} />
        </>
      )}
    </div>
  );
};
````

### packages/phaser-client/src/store/gameStore.ts

Zustand store for game state management:

````typescript
import { create } from 'zustand';
import { DiscordSDK } from '@discord/embedded-app-sdk';

interface Player {
  id: string;
  x: number;
  y: number;
  health: number;
  maxHealth: number;
  level: number;
  experience: number;
}

interface GameStore {
  // Discord
  discordUser: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  } | null;
  discordSDK: DiscordSDK | null;

  // Game state
  player: Player | null;
  players: Map<string, Player>;
  connectionStatus: 'disconnected' | 'connecting' | 'connected';

  // UI state
  inventoryOpen: boolean;
  skillsOpen: boolean;
  chatOpen: boolean;

  // Actions
  setDiscordUser: (user: GameStore['discordUser']) => void;
  setDiscordSDK: (sdk: DiscordSDK) => void;
  setPlayer: (player: Player) => void;
  updatePlayer: (id: string, updates: Partial<Player>) => void;
  removePlayer: (id: string) => void;
  setConnectionStatus: (status: GameStore['connectionStatus']) => void;
  toggleInventory: () => void;
  toggleSkills: () => void;
  toggleChat: () => void;
  reset: () => void;
}

/**
 * Global game state store
 */
export const useGameStore = create<GameStore>((set) => ({
  // Initial state
  discordUser: null,
  discordSDK: null,
  player: null,
  players: new Map(),
  connectionStatus: 'disconnected',
  inventoryOpen: false,
  skillsOpen: false,
  chatOpen: true,

  // Actions
  setDiscordUser: (user) => set({ discordUser: user }),
  setDiscordSDK: (sdk) => set({ discordSDK: sdk }),
  
  setPlayer: (player) => set({ player }),
  
  updatePlayer: (id, updates) => set((state) => {
    const players = new Map(state.players);
    const existing = players.get(id);
    if (existing) {
      players.set(id, { ...existing, ...updates });
    } else {
      players.set(id, { id, x: 0, y: 0, health: 100, maxHealth: 100, level: 1, experience: 0, ...updates });
    }
    
    // Update main player if it's them
    if (state.player?.id === id && existing) {
      return { players, player: { ...existing, ...updates } };
    }
    
    return { players };
  }),
  
  removePlayer: (id) => set((state) => {
    const players = new Map(state.players);
    players.delete(id);
    return { players };
  }),
  
  setConnectionStatus: (connectionStatus) => set({ connectionStatus }),
  
  toggleInventory: () => set((state) => ({ inventoryOpen: !state.inventoryOpen })),
  toggleSkills: () => set((state) => ({ skillsOpen: !state.skillsOpen })),
  toggleChat: () => set((state) => ({ chatOpen: !state.chatOpen })),
  
  reset: () => set({
    player: null,
    players: new Map(),
    connectionStatus: 'disconnected',
    inventoryOpen: false,
    skillsOpen: false,
    chatOpen: true,
  }),
}));
````

### packages/server/src/index.ts

Update server to add Discord OAuth2 endpoints:

````typescript
// ...existing code...

import jwt from 'jsonwebtoken';
import axios from 'axios';

// ...existing code...

// Add environment validation
const requiredEnvVars = [
  'DISCORD_CLIENT_ID',
  'DISCORD_CLIENT_SECRET',
  'JWT_SECRET',
];

for (const envVar of requiredEnvVars) {
  if (!process.env[envVar]) {
    throw new Error(`Missing required environment variable: ${envVar}`);
  }
}

// ...existing code...

// Discord OAuth2 endpoints
app.post('/api/auth/discord/token', async (req, res) => {
  try {
    const { code } = req.body;

    if (!code) {
      return res.status(400).json({ error: 'Code is required' });
    }

    // Exchange code for Discord access token
    const tokenResponse = await axios.post(
      'https://discord.com/api/oauth2/token',
      new URLSearchParams({
        client_id: process.env.DISCORD_CLIENT_ID!,
        client_secret: process.env.DISCORD_CLIENT_SECRET!,
        grant_type: 'authorization_code',
        code,
      }),
      {
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
      }
    );

    const { access_token, refresh_token } = tokenResponse.data;

    // Get user info from Discord
    const userResponse = await axios.get('https://discord.com/api/users/@me', {
      headers: {
        Authorization: `Bearer ${access_token}`,
      },
    });

    const discordUser = userResponse.data;

    // Create JWT for our app
    const token = jwt.sign(
      {
        id: discordUser.id,
        username: discordUser.username,
        discriminator: discordUser.discriminator,
        avatar: discordUser.avatar,
      },
      process.env.JWT_SECRET!,
      { expiresIn: '24h' }
    );

    res.json({
      access_token,
      refresh_token,
      token,
      user: discordUser,
    });
  } catch (error) {
    console.error('Discord token exchange error:', error);
    res.status(500).json({ error: 'Failed to authenticate with Discord' });
  }
});

// Verify JWT middleware
export const verifyToken = (req: any, res: any, next: any) => {
  const token = req.headers.authorization?.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'No token provided' });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'Invalid token' });
  }
};

// Protected endpoint example
app.get('/api/auth/me', verifyToken, (req: any, res) => {
  res.json({ user: req.user });
});

// ...existing code...
````

### packages/phaser-client/src/components/MainMenu.tsx

Create the main menu component:

````typescript
import React from 'react';

interface MainMenuProps {
  user: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  };
  onStartGame: () => void;
  error: string | null;
}

/**
 * Main menu component
 */
export const MainMenu: React.FC<MainMenuProps> = ({ user, onStartGame, error }) => {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="discord-panel max-w-md w-full mx-4">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold mb-2">RuneRogue</h1>
          <p className="text-gray-400">OSRS-inspired multiplayer roguelike</p>
        </div>

        <div className="flex items-center justify-center mb-8">
          <div className="flex items-center space-x-3 bg-discord-darker rounded-lg px-4 py-2">
            {user.avatar && (
              <img
                src={`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`}
                alt={user.username}
                className="w-8 h-8 rounded-full"
              />
            )}
            <span className="font-medium">{user.username}</span>
          </div>
        </div>

        {error && (
          <div className="bg-discord-red/20 border border-discord-red rounded-lg p-3 mb-4">
            <p className="text-sm text-discord-red">{error}</p>
          </div>
        )}

        <div className="space-y-3">
          <button
            onClick={onStartGame}
            className="discord-button w-full text-lg py-3"
          >
            Play Now
          </button>
          
          <button className="w-full py-3 text-gray-400 hover:text-white transition-colors">
            How to Play
          </button>
        </div>

        <div className="mt-8 text-center text-xs text-gray-500">
          <p>v0.1.0 - Phase 1 Prototype</p>
        </div>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/components/LoadingScreen.tsx

Create loading screen component:

````typescript
import React from 'react';

/**
 * Loading screen component
 */
export const LoadingScreen: React.FC = () => {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="text-center">
        <div className="animate-spin rounded-full h-16 w-16 border-4 border-discord-blurple border-t-transparent mb-4 mx-auto"></div>
        <h2 className="text-xl font-semibold mb-2">Connecting to RuneRogue</h2>
        <p className="text-gray-400">Preparing your adventure...</p>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/components/GameUI.tsx

Create game UI overlay component:

````typescript
import React from 'react';
import { useGameStore } from '../store/gameStore';

interface GameUIProps {
  onReturnToMenu: () => void;
}

/**
 * In-game UI overlay
 */
export const GameUI: React.FC<GameUIProps> = ({ onReturnToMenu }) => {
  const { player, connectionStatus } = useGameStore();

  return (
    <div className="absolute inset-0 pointer-events-none">
      {/* Health Bar */}
      {player && (
        <div className="absolute top-4 left-4 discord-panel pointer-events-auto">
          <div className="flex items-center gap-3">
            <div className="text-red-500">❤️</div>
            <div className="relative w-48 h-4 bg-discord-darker rounded-full overflow-hidden">
              <div
                className="absolute inset-y-0 left-0 bg-red-500 transition-all duration-300"
                style={{ width: `${(player.health / player.maxHealth) * 100}%` }}
              />
            </div>
            <span className="text-sm font-medium">
              {player.health}/{player.maxHealth}
            </span>
          </div>
        </div>
      )}

      {/* Connection Status */}
      <div className="absolute top-4 right-4 pointer-events-auto">
        <div className="discord-panel flex items-center gap-2">
          <div
            className={`w-2 h-2 rounded-full ${
              connectionStatus === 'connected'
                ? 'bg-discord-green'
                : connectionStatus === 'connecting'
                ? 'bg-discord-yellow'
                : 'bg-discord-red'
            }`}
          />
          <span className="text-sm capitalize">{connectionStatus}</span>
        </div>
      </div>

      {/* Menu Button */}
      <div className="absolute bottom-4 right-4 pointer-events-auto">
        <button
          onClick={onReturnToMenu}
          className="discord-button text-sm"
        >
          Return to Menu
        </button>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/network/NetworkManager.ts

Create network manager for Colyseus connection:

````typescript
import { Client, Room } from 'colyseus.js';
import { useGameStore } from '../store/gameStore';

/**
 * Manages connection to Colyseus game server
 */
export class NetworkManager {
  private client: Client;
  private room: Room | null = null;

  constructor(
    private serverUrl: string,
    private userId: string
  ) {
    this.client = new Client(serverUrl);
  }

  /**
   * Connect to the game server
   */
  async connect(): Promise<void> {
    useGameStore.getState().setConnectionStatus('connecting');
    
    try {
      // Test connection
      const response = await fetch(this.serverUrl.replace('wss://', 'https://') + '/health');
      if (!response.ok) {
        throw new Error('Server is not responding');
      }
      
      useGameStore.getState().setConnectionStatus('connected');
    } catch (error) {
      useGameStore.getState().setConnectionStatus('disconnected');
      throw new Error(`Failed to connect to server: ${error}`);
    }
  }

  /**
   * Join a game room
   */
  async joinRoom(roomName: string, options: any): Promise<Room> {
    try {
      this.room = await this.client.joinOrCreate(roomName, options);
      
      // Set up room event handlers
      this.setupRoomHandlers();
      
      return this.room;
    } catch (error) {
      throw new Error(`Failed to join room: ${error}`);
    }
  }

  /**
   * Set up event handlers for the room
   */
  private setupRoomHandlers(): void {
    if (!this.room) return;

    this.room.onStateChange((state) => {
      // Handle state updates
      console.log('Room state changed:', state);
    });

    this.room.onMessage('*', (type, message) => {
      console.log('Received message:', type, message);
    });

    this.room.onLeave((code) => {
      console.log('Left room with code:', code);
      useGameStore.getState().setConnectionStatus('disconnected');
    });

    this.room.onError((code, message) => {
      console.error('Room error:', code, message);
    });
  }

  /**
   * Send a message to the server
   */
  send(type: string, data: any): void {
    if (!this.room) {
      throw new Error('Not connected to a room');
    }
    
    this.room.send(type, data);
  }

  /**
   * Disconnect from the server
   */
  disconnect(): void {
    if (this.room) {
      this.room.leave();
      this.room = null;
    }
    useGameStore.getState().setConnectionStatus('disconnected');
  }

  /**
   * Get the current room
   */
  getRoom(): Room | null {
    return this.room;
  }
}
````

### packages/phaser-client/src/game/Game.ts

Create basic Phaser game class:

````typescript
import Phaser from 'phaser';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { NetworkManager } from '../network/NetworkManager';
import { MainScene } from './scenes/MainScene';

/**
 * Main Phaser game class
 */
export class Game {
  private phaserGame: Phaser.Game;
  private readyPromise: Promise<void>;

  constructor(
    containerId: string,
    private networkManager: NetworkManager,
    private discord: DiscordSDK
  ) {
    const config: Phaser.Types.Core.GameConfig = {
      type: Phaser.AUTO,
      parent: containerId,
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundColor: '#2f3136',
      scale: {
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH,
      },
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 0 },
          debug: process.env.NODE_ENV === 'development',
        },
      },
      scene: [],
    };

    this.phaserGame = new Phaser.Game(config);

    // Create ready promise
    this.readyPromise = new Promise((resolve) => {
      this.phaserGame.events.once('ready', () => {
        // Add main scene
        const mainScene = new MainScene(this.networkManager, this.discord);
        this.phaserGame.scene.add('MainScene', mainScene, true);
        resolve();
      });
    });
  }

  /**
   * Wait for game to be ready
   */
  async ready(): Promise<void> {
    return this.readyPromise;
  }

  /**
   * Destroy the game
   */
  destroy(): void {
    this.phaserGame.destroy(true);
  }
}
````

### packages/phaser-client/src/game/scenes/MainScene.ts

Create main game scene:

````typescript
import Phaser from 'phaser';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { NetworkManager } from '../../network/NetworkManager';
import { useGameStore } from '../../store/gameStore';

/**
 * Main game scene
 */
export class MainScene extends Phaser.Scene {
  private cursors!: Phaser.Types.Input.Keyboard.CursorKeys;
  private wasd!: {
    w: Phaser.Input.Keyboard.Key;
    a: Phaser.Input.Keyboard.Key;
    s: Phaser.Input.Keyboard.Key;
    d: Phaser.Input.Keyboard.Key;
  };
  private player!: Phaser.Physics.Arcade.Sprite;
  private otherPlayers: Map<string, Phaser.Physics.Arcade.Sprite> = new Map();

  constructor(
    private networkManager: NetworkManager,
    private discord: DiscordSDK
  ) {
    super({ key: 'MainScene' });
  }

  preload(): void {
    // Create placeholder graphics
    this.load.image('player', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
  }

  create(): void {
    // Create tilemap background (placeholder)
    this.createWorld();

    // Create player
    this.createPlayer();

    // Set up input
    this.setupInput();

    // Set up network handlers
    this.setupNetworkHandlers();

    // Set up camera
    this.cameras.main.startFollow(this.player);
    this.cameras.main.setZoom(2);
  }

  update(time: number, delta: number): void {
    if (!this.player) return;

    // Handle movement
    const speed = 200;
    let vx = 0;
    let vy = 0;

    if (this.cursors.left.isDown || this.wasd.a.isDown) {
      vx = -speed;
    } else if (this.cursors.right.isDown || this.wasd.d.isDown) {
      vx = speed;
    }

    if (this.cursors.up.isDown || this.wasd.w.isDown) {
      vy = -speed;
    } else if (this.cursors.down.isDown || this.wasd.s.isDown) {
      vy = speed;
    }

    // Apply velocity
    this.player.setVelocity(vx, vy);

    // Send position to server if moving
    if (vx !== 0 || vy !== 0) {
      this.networkManager.send('move', {
        x: this.player.x,
        y: this.player.y,
        vx,
        vy,
      });
    }
  }

  private createWorld(): void {
    // Create a simple grid background
    const graphics = this.add.graphics();
    graphics.lineStyle(1, 0x444444, 0.5);

    const gridSize = 32;
    const worldWidth = 2000;
    const worldHeight = 2000;

    for (let x = 0; x <= worldWidth; x += gridSize) {
      graphics.moveTo(x, 0);
      graphics.lineTo(x, worldHeight);
    }

    for (let y = 0; y <= worldHeight; y += gridSize) {
      graphics.moveTo(0, y);
      graphics.lineTo(worldWidth, y);
    }

    graphics.strokePath();

    // Set world bounds
    this.physics.world.setBounds(0, 0, worldWidth, worldHeight);
  }

  private createPlayer(): void {
    // Create player sprite (placeholder - red square)
    const graphics = this.make.graphics({ x: 0, y: 0 });
    graphics.fillStyle(0xff0000);
    graphics.fillRect(0, 0, 32, 32);
    graphics.generateTexture('player-texture', 32, 32);
    graphics.destroy();

    this.player = this.physics.add.sprite(400, 300, 'player-texture');
    this.player.setCollideWorldBounds(true);

    // Update store
    useGameStore.getState().setPlayer({
      id: this.discord.instanceId || 'local',
      x: this.player.x,
      y: this.player.y,
      health: 100,
      maxHealth: 100,
      level: 1,
      experience: 0,
    });
  }

  private setupInput(): void {
    this.cursors = this.input.keyboard!.createCursorKeys();
    this.wasd = {
      w: this.input.keyboard!.addKey('W'),
      a: this.input.keyboard!.addKey('A'),
      s: this.input.keyboard!.addKey('S'),
      d: this.input.keyboard!.addKey('D'),
    };
  }

  private setupNetworkHandlers(): void {
    const room = this.networkManager.getRoom();
    if (!room) return;

    room.state.players.onAdd((player: any, key: string) => {
      if (key === this.discord.instanceId) return; // Skip self

      // Create other player sprite (blue square)
      const graphics = this.make.graphics({ x: 0, y: 0 });
      graphics.fillStyle(0x0000ff);
      graphics.fillRect(0, 0, 32, 32);
      graphics.generateTexture(`player-${key}`, 32, 32);
      graphics.destroy();

      const sprite = this.physics.add.sprite(player.x, player.y, `player-${key}`);
      this.otherPlayers.set(key, sprite);

      // Update store
      useGameStore.getState().updatePlayer(key, {
        x: player.x,
        y: player.y,
        health: player.health,
        maxHealth: player.maxHealth,
        level: player.level,
        experience: player.experience,
      });
    });

    room.state.players.onChange((player: any, key: string) => {
      const sprite = this.otherPlayers.get(key);
      if (sprite) {
        sprite.setPosition(player.x, player.y);
        
        // Update store
        useGameStore.getState().updatePlayer(key, {
          x: player.x,
          y: player.y,
          health: player.health,
          maxHealth: player.maxHealth,
          level: player.level,
          experience: player.experience,
        });
      }
    });

    room.state.players.onRemove((player: any, key: string) => {
      const sprite = this.otherPlayers.get(key);
      if (sprite) {
        sprite.destroy();
        this.otherPlayers.delete(key);
        
        // Update store
        useGameStore.getState().removePlayer(key);
      }
    });
  }
}
````

These changes establish a complete foundation for the Discord Activity client with:

1. **Proper package structure** with all required dependencies
2. **Discord SDK integration** with authentication flow
3. **React + Phaser hybrid architecture** for UI and game rendering
4. **Colyseus network connection** setup
5. **Zustand state management** for game state
6. **Tailwind CSS styling** matching Discord's design
7. **Basic game scene** with player movement
8. **Server-side Discord OAuth2** endpoints

The client is now ready for Phase 1 development with a working Discord Activity structure, multiplayer foundation, and basic gameplay elements.

---

_**User**_

continue

---

_**Assistant**_

Looking at the project overview, I see we're at Phase 1 Week 1, focusing on Discord Setup & Client Foundation. Based on the immediate action items, I'll help you continue setting up the client package structure and implementing the Discord Activity foundation.

## Solution Overview

I'll create the necessary files to establish the Discord Activity client foundation with:
1. Proper package configuration
2. TypeScript configuration
3. Tailwind CSS setup
4. ESLint configuration
5. Main entry point with Discord SDK initialization
6. Basic App component structure
7. Create missing test file structure

## File Changes

### packages/phaser-client/tsconfig.json

Create TypeScript configuration for the client:

````json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "allowJs": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@runerogue/shared": ["../shared/src"]
    }
  },
  "include": ["src", "vite.config.ts"],
  "references": [{ "path": "../shared" }]
}
````

### packages/phaser-client/tailwind.config.js

Configure Tailwind CSS with Discord-themed colors:

````javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      colors: {
        discord: {
          dark: '#202225',
          darker: '#2f3136',
          darkest: '#36393f',
          blurple: '#5865f2',
          'blurple-hover': '#4752c4',
          green: '#3ba55d',
          red: '#ed4245',
          yellow: '#faa81a',
        },
      },
      fontFamily: {
        discord: ['gg sans', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
      },
    },
  },
  plugins: [],
};
````

### packages/phaser-client/postcss.config.js

Configure PostCSS for Tailwind:

````javascript
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
````

### packages/phaser-client/.eslintrc.json

Add ESLint configuration:

````json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2020,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "plugins": ["@typescript-eslint", "react", "react-hooks"],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "@typescript-eslint/explicit-module-boundary-types": "off",
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/no-unused-vars": ["warn", { "argsIgnorePattern": "^_" }]
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  },
  "env": {
    "browser": true,
    "es2020": true,
    "node": true
  }
}
````

### packages/phaser-client/index.html

Create the HTML entry point:

````html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RuneRogue - Discord Activity</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
````

### packages/phaser-client/src/main.tsx

Create the main entry point with Discord SDK initialization:

````typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { App } from './App';
import './index.css';

/**
 * Initialize Discord SDK and render the app
 */
async function initializeApp() {
  try {
    // Initialize Discord SDK
    const discordSdk = new DiscordSDK(import.meta.env.VITE_DISCORD_CLIENT_ID);
    
    // Wait for Discord to be ready
    await discordSdk.ready();
    console.log('Discord SDK initialized');

    // Authenticate with Discord
    const { code } = await discordSdk.commands.authorize({
      client_id: import.meta.env.VITE_DISCORD_CLIENT_ID,
      response_type: 'code',
      state: '',
      prompt: 'none',
      scope: ['identify', 'guilds', 'rpc.voice.read'],
    });

    // Exchange code for access token via our backend
    const response = await fetch('/api/auth/discord/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ code }),
    });

    if (!response.ok) {
      throw new Error('Failed to authenticate with Discord');
    }

    const { access_token } = await response.json();

    // Authenticate SDK with access token
    const auth = await discordSdk.commands.authenticate({
      access_token,
    });

    if (!auth.user) {
      throw new Error('Failed to get Discord user');
    }

    console.log('Authenticated as:', auth.user.username);

    // Render the app with Discord context
    const root = ReactDOM.createRoot(
      document.getElementById('root') as HTMLElement
    );

    root.render(
      <React.StrictMode>
        <App discord={discordSdk} user={auth.user} />
      </React.StrictMode>
    );
  } catch (error) {
    console.error('Failed to initialize Discord Activity:', error);
    
    // Render error state
    const root = ReactDOM.createRoot(
      document.getElementById('root') as HTMLElement
    );
    
    root.render(
      <React.StrictMode>
        <div className="flex items-center justify-center min-h-screen bg-discord-darkest text-white">
          <div className="text-center">
            <h1 className="text-2xl font-bold mb-4">Failed to Initialize</h1>
            <p className="text-gray-400">Please ensure you're running this as a Discord Activity.</p>
            <p className="text-sm text-gray-500 mt-2">{String(error)}</p>
          </div>
        </div>
      </React.StrictMode>
    );
  }
}

// Initialize the app
initializeApp();
````

### packages/phaser-client/src/index.css

Create the main CSS file with Tailwind imports:

````css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply bg-discord-darkest text-white font-discord;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  #root {
    width: 100vw;
    height: 100vh;
  }
}

@layer components {
  .discord-button {
    @apply bg-discord-blurple hover:bg-discord-blurple-hover text-white font-medium py-2 px-4 rounded transition-colors;
  }

  .discord-panel {
    @apply bg-discord-dark rounded-lg p-4 shadow-lg;
  }

  .discord-input {
    @apply bg-discord-darker border border-gray-600 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-discord-blurple;
  }
}
````

### packages/phaser-client/src/App.tsx

Create the main App component:

````typescript
import React, { useState, useEffect } from 'react';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { MainMenu } from './components/MainMenu';
import { GameView } from './components/GameView';
import { LoadingScreen } from './components/LoadingScreen';

interface AppProps {
  discord: DiscordSDK;
  user: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  };
}

/**
 * Main application component
 */
export const App: React.FC<AppProps> = ({ discord, user }) => {
  const [gameState, setGameState] = useState<'menu' | 'loading' | 'playing'>('menu');
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // Set initial Discord activity
    discord.commands.setActivity({
      state: 'In Menu',
      details: 'RuneRogue',
    });
  }, [discord]);

  const handleStartGame = async () => {
    try {
      setGameState('loading');
      setError(null);
      
      // TODO: Initialize game connection
      // For now, just simulate loading
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      setGameState('playing');
      
      // Update Discord activity
      discord.commands.setActivity({
        state: 'Playing',
        details: 'RuneRogue',
      });
    } catch (err) {
      console.error('Failed to start game:', err);
      setError(err instanceof Error ? err.message : 'Failed to start game');
      setGameState('menu');
    }
  };

  const handleReturnToMenu = () => {
    setGameState('menu');
    discord.commands.setActivity({
      state: 'In Menu',
      details: 'RuneRogue',
    });
  };

  return (
    <div className="w-full h-full bg-discord-darkest">
      {gameState === 'menu' && (
        <MainMenu
          user={user}
          onStartGame={handleStartGame}
          error={error}
        />
      )}
      
      {gameState === 'loading' && <LoadingScreen />}
      
      {gameState === 'playing' && (
        <GameView
          discord={discord}
          user={user}
          onReturnToMenu={handleReturnToMenu}
        />
      )}
    </div>
  );
};
````

### packages/phaser-client/src/components/MainMenu.tsx

Create the main menu component:

````typescript
import React from 'react';

interface MainMenuProps {
  user: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  };
  onStartGame: () => void;
  error: string | null;
}

/**
 * Main menu component
 */
export const MainMenu: React.FC<MainMenuProps> = ({ user, onStartGame, error }) => {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="discord-panel max-w-md w-full mx-4">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold mb-2">RuneRogue</h1>
          <p className="text-gray-400">OSRS-inspired multiplayer roguelike</p>
        </div>

        <div className="flex items-center justify-center mb-8">
          <div className="flex items-center space-x-3 bg-discord-darker rounded-lg px-4 py-2">
            {user.avatar && (
              <img
                src={`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`}
                alt={user.username}
                className="w-8 h-8 rounded-full"
              />
            )}
            <span className="font-medium">{user.username}</span>
          </div>
        </div>

        {error && (
          <div className="bg-discord-red/20 border border-discord-red rounded-lg p-3 mb-4">
            <p className="text-sm text-discord-red">{error}</p>
          </div>
        )}

        <div className="space-y-3">
          <button
            onClick={onStartGame}
            className="discord-button w-full text-lg py-3"
          >
            Play Now
          </button>
          
          <button className="w-full py-3 text-gray-400 hover:text-white transition-colors">
            How to Play
          </button>
        </div>

        <div className="mt-8 text-center text-xs text-gray-500">
          <p>v0.1.0 - Phase 1 Prototype</p>
        </div>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/components/LoadingScreen.tsx

Create loading screen component:

````typescript
import React from 'react';

/**
 * Loading screen component
 */
export const LoadingScreen: React.FC = () => {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="text-center">
        <div className="animate-spin rounded-full h-16 w-16 border-4 border-discord-blurple border-t-transparent mb-4 mx-auto"></div>
        <h2 className="text-xl font-semibold mb-2">Connecting to RuneRogue</h2>
        <p className="text-gray-400">Preparing your adventure...</p>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/components/GameView.tsx

Create the game view component (placeholder for now):

````typescript
import React, { useEffect, useRef } from 'react';
import { DiscordSDK } from '@discord/embedded-app-sdk';

interface GameViewProps {
  discord: DiscordSDK;
  user: {
    id: string;
    username: string;
    discriminator: string;
    avatar: string | null;
  };
  onReturnToMenu: () => void;
}

/**
 * Game view component - will contain Phaser game
 */
export const GameView: React.FC<GameViewProps> = ({ discord, user, onReturnToMenu }) => {
  const gameContainerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // TODO: Initialize Phaser game here
    console.log('Game view mounted, ready to initialize Phaser');

    return () => {
      // TODO: Cleanup Phaser game
      console.log('Game view unmounting, cleanup Phaser');
    };
  }, []);

  return (
    <div className="relative w-full h-full">
      {/* Game container */}
      <div ref={gameContainerRef} id="game-container" className="w-full h-full" />
      
      {/* UI Overlay */}
      <div className="absolute inset-0 pointer-events-none">
        {/* Top bar */}
        <div className="absolute top-4 left-4 right-4 flex justify-between pointer-events-auto">
          <div className="discord-panel">
            <p className="text-sm">Playing as: {user.username}</p>
          </div>
          
          <button
            onClick={onReturnToMenu}
            className="discord-button text-sm"
          >
            Return to Menu
          </button>
        </div>
        
        {/* Placeholder for game UI */}
        <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 discord-panel pointer-events-auto">
          <p className="text-center">Game UI will appear here</p>
        </div>
      </div>
    </div>
  );
};
````

### packages/phaser-client/src/vite-env.d.ts

Create Vite environment types:

````typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_DISCORD_CLIENT_ID: string;
  readonly VITE_GAME_SERVER_URL: string;
  readonly VITE_API_URL: string;
  readonly VITE_HTTPS_KEY: string;
  readonly VITE_HTTPS_CERT: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
````

### packages/phaser-client/test/setup.ts

Create test setup file:

````typescript
/**
 * Test setup for phaser-client
 */

// Mock Discord SDK for tests
jest.mock('@discord/embedded-app-sdk', () => ({
  DiscordSDK: jest.fn().mockImplementation(() => ({
    ready: jest.fn().mockResolvedValue(undefined),
    commands: {
      authorize: jest.fn().mockResolvedValue({ code: 'test-code' }),
      authenticate: jest.fn().mockResolvedValue({
        user: {
          id: '123456789',
          username: 'TestUser',
          discriminator: '0001',
          avatar: null,
        },
      }),
      setActivity: jest.fn().mockResolvedValue(undefined),
    },
  })),
}));

// Mock fetch for tests
global.fetch = jest.fn();

// Setup DOM environment
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});
````

### packages/phaser-client/test/App.test.tsx

Create basic test for App component:

````typescript
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import { DiscordSDK } from '@discord/embedded-app-sdk';
import { App } from '../src/App';

describe('App Component', () => {
  let mockDiscord: DiscordSDK;
  const mockUser = {
    id: '123456789',
    username: 'TestUser',
    discriminator: '0001',
    avatar: null,
  };

  beforeEach(() => {
    mockDiscord = new DiscordSDK('test-client-id');
  });

  it('should render main menu initially', () => {
    render(<App discord={mockDiscord} user={mockUser} />);
    
    expect(screen.getByText('RuneRogue')).toBeInTheDocument();
    expect(screen.getByText('Play Now')).toBeInTheDocument();
    expect(screen.getByText('TestUser')).toBeInTheDocument();
  });

  it('should set Discord activity on mount', async () => {
    render(<App discord={mockDiscord} user={mockUser} />);
    
    await waitFor(() => {
      expect(mockDiscord.commands.setActivity).toHaveBeenCalledWith({
        state: 'In Menu',
        details: 'RuneRogue',
      });
    });
  });
});
````

These files establish a complete foundation for the Discord Activity client with:

1. **TypeScript configuration** with strict mode and proper paths
2. **Tailwind CSS** with Discord-themed design tokens
3. **ESLint** for code quality
4. **React components** with proper structure and error handling
5. **Discord SDK integration** with authentication flow
6. **Test setup** with proper mocks

The client is now ready for the next steps in Phase 1 Week 2, where you'll implement the NetworkManager for Colyseus and create the actual game functionality with Phaser.

---

_**User**_

edit all the files you mentioned need changes

---

_**Assistant**_

I'll edit all the files needed to establish the Phase 1 foundation for the Discord Activity. Let me update each file systematically.

### packages/phaser-client/package.json

````json
{
  "name": "@runerogue/phaser-client",
  "version": "0.1.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "type-check": "tsc --noEmit",
    "lint": "eslint src --ext ts,tsx",
    "test": "jest"
  },
  "dependencies": {
    "@discord/embedded-app-sdk": "^1.2.0",
    "@runerogue/shared": "workspace:*",
    "colyseus.js": "^0.15.0",
    "phaser": "^3.70.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.7"
  },
  "devDependencies": {
    "@types/jest": "^29.5.0",
    "@types/node": "^20.0.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^8.0.0",
    "eslint-plugin-react": "^7.0.0",
    "eslint-plugin-react-hooks": "^4.0.0",
    "jest": "^29.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.0",
    "ts-jest": "^29.1.0",
    "typescript": "^5.0.0",
    "vite": "^5.0.0"
  }
}
````

### packages/phaser-client/vite.config.ts

````typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import fs from 'fs';
import path

---

