<!-- Generated by SpecStory -->

#  (2025-06-21 23:18:51)

_**User**_


Context:
We are working on the RuneRogue project, which must match Old School RuneScape (OSRS) mechanics exactly. The PrayerSystem drain logic is not working as expected in unit tests: the prayer points never drain, and the timer never accumulates. The system expects a drain rate in points per minute, and the test now provides this correctly. However, the debug output shows that Prayer.drainTimer[eid] is always 0 after each tick, so no drain occurs.

What to do next:

Diagnose why Prayer.drainTimer[eid] is always 0 after each tick.

Is the ECS world or component being reset between ticks?
Is the query returning the correct entity each tick?
Is the system logic for updating the timer being skipped due to a condition?
Is there a bug in the test setup or the system's use of the timer?
Create a minimal test case that:

Adds a single entity with the Prayer component.
Sets Prayer.current[eid] and Prayer.activeMask[eid] only.
Runs the system for a few ticks, logging the timer and current value before and after each tick.
Confirms that the timer accumulates and prayer points eventually drain.
If the timer still does not accumulate:

Inspect the ECS/bitecs world and query setup for issues.
Check for any code that might be resetting the component or world state between ticks.
Once the timer accumulates and drain works:

Restore the main test to use the correct setup.
Remove debug logging and ensure the test passes.
Ensure all code and tests are OSRS-authentic, type-safe, and well-documented.
Summarize the root cause and the fix.

Reference:

All code must match OSRS mechanics exactly (see core-standards and test instructions).
Use strict TypeScript, JSDoc, and error handling.
See the current jest.config.cjs and project structure for context.
Goal:
Get the PrayerSystem drain logic and tests working with full OSRS authenticity, and document the root cause and solution.

---

_**Assistant**_



---

